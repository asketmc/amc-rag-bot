# üß© Asketmc RAG Discord Bot ‚Äî Production-Grade RAG/LLM Example

**Retrieval-Augmented Generation Discord bot for Russian-language knowledge bases, built with local LLM (Llama 3.x), advanced lemmatization, full rerank pipeline, and robust async/Python3.10 architecture.**  
_This repository demonstrates a professional, production-grade implementation of a custom RAG backend and Discord bot, with an emphasis on code quality, modularity, and reproducibility for LLM QA / ML Engineer roles._

---

## üìå Overview

This project is an open-source RAG backend and Discord bot designed for Russian-language file-based knowledge bases. It combines local LLM inference (Ollama + Llama3), hybrid context retrieval (llama-index), advanced lemmatization with Stanza and spaCy, async-safe CrossEncoder reranking, and secure Discord integration.

**Key goals:**
- Demonstrate best practices for building, testing, and running production-ready RAG pipelines.
- Show advanced modular code structure and robust error handling for LLM/ML backend applications.
- Support evaluation/interview scenarios for LLM QA / ML Engineering positions.

---

## üöÄ Features

- **RAG pipeline**: Retrieval (llama-index) + full rerank (CrossEncoder, async thread pool).
- **Multi-language lemmatization**: Russian (Stanza), English (spaCy), lazy cache with SHA256 chunking.
- **File-based KB**: Hot reload, hash-tracking, async-safe cache, and document-level lemma indices.
- **Fallback and fail-safe**: Robust fallback to local LLM, OpenRouter integration, transparent error propagation.
- **Discord bot**: Async, command-based, role/permission management, safe input/output, context size management.
- **Traceable logs**: Rotating logs per subsystem, DEBUG mode with maximum granularity.
- **Configurable**: All paths, model names, device settings, limits, and allowed channels set in `config.py` and `.env`.
- **Production security**: No hardcoded secrets, support for env overrides, ignore sensitive files via `.gitignore`.

---

## üõ†Ô∏è Architecture

**Main components:**
- `main.py` ‚Äî Entry point; index build, lemmatization, bot lifecycle, orchestration.
- `rerank.py` ‚Äî Async-safe CrossEncoder reranker (CPU/GPU switch, resource control, thread pool).
- `config.py` ‚Äî All settings, paths, regular expressions, admin/ACLs.
- `parsed/` ‚Äî Knowledge base; all source .txt/.md files.
- `rag_cache/` ‚Äî Vector index and lemma cache.
- `logs/` ‚Äî Rotating logs per subsystem.

**Stack:**
- **LLM**: Ollama + Llama 3.x (`LOCAL_MODEL`)
- **Vector DB**: llama-index (VectorStoreIndex)
- **Embeddings**: BAAI/bge-m3, Nomic (optionally)
- **Rerank**: BAAI/bge-reranker-v2-m3 (CrossEncoder)
- **NLP**: stanza, spaCy, langdetect
- **Discord API**: discord.py + aiohttp

---

## üì¶ Project structure

/LLM
‚îÇ main.py
‚îÇ rerank.py
‚îÇ config.py
‚îÇ requirements.txt
‚îÇ .env-example
‚îÇ system_prompt_strict.txt
‚îÇ system_prompt_reason.txt
‚îÇ rephrase.txt
‚îÇ
‚îú‚îÄ‚îÄ parsed/ # All source documents for the KB (.txt/.md)
‚îú‚îÄ‚îÄ rag_cache/ # Index and lemma cache (autogenerated)
‚îú‚îÄ‚îÄ logs/ # Rotating logs (autogenerated)

---

## üèÅ Quickstart

1. **Clone the repo:**
    ```sh
    git clone https://github.com/youruser/amc-rag-bot.git
    cd amc-rag-bot
    ```

2. **Install dependencies:**
    ```sh
    pip install -r requirements.txt
    python -m spacy download en_core_web_sm
    python -m stanza.download ru
    ```

3. **Set up `.env`:**
    ```env
    DISCORD_TOKEN=your-discord-bot-token
    OPENROUTER_API_KEY=your-openrouter-api-key
    ```

4. **Add .txt/.md files to `/parsed`**.

5. **Launch the bot:**
    ```sh
    python main.py
    ```

---

## ‚öôÔ∏è Configuration

- All settings in `config.py`: paths, models, batch sizes, allowed channels, admin IDs.
- Fine-tune model/device/limits per project.
- Default prompts: `system_prompt_strict.txt`, `system_prompt_reason.txt`.

---

## üß™ RAG/LLM Evaluation & QA

- Fully transparent logs (per module, per request).
- Debug-mode: logs every rerank, cache hit, vector op, Discord event.
- Ready for edge-case/negative-path testing.
- Strict input sanitization, size limits, safe regex for Discord.

---

## üí¨ Discord commands

- `!—Å–ø—Ä–∞–≤–∫–∞ <–≤–æ–ø—Ä–æ—Å>` ‚Äî Standard RAG answer (retrieval + rerank + LLM).
- `!–ª–æ–∫–∞–ª—å–Ω–æ <–≤–æ–ø—Ä–æ—Å>` ‚Äî RAG answer using only local LLM.
- `!–ø–æ–¥—É–º–∞–π <–≤–æ–ø—Ä–æ—Å>` ‚Äî Reasoning-focused system prompt.
- `!reload_index` ‚Äî Hot-reload KB (admin only).
- `!—Å—Ç–∞—Ç—É—Å` ‚Äî Bot/KB/debug info.
- `!stop` ‚Äî Shutdown (admin only).

---

## üìã requirements.txt

```txt
python-dotenv
discord.py>=2.0.0
aiohttp
stanza
spacy
langdetect
llama-index>=0.10.0
sentence-transformers
torch
nomic
safetensors
```

üõ°Ô∏è License
MIT

‚úçÔ∏è About this repository
This repository is a professional, production-grade code example
created to showcase advanced skills in RAG, LLM orchestration, knowledge base QA, modular Python architecture, and ML system security.
Contact: asketmc.team+rabot@gmail.com

Feel free to use this as a reference for LLM QA / ML Engineer technical interviews, internal tool PoC, or further RAG research.
